## elasticsearch(es)-搜索引擎
具体简介: (https://blog.csdn.net/UbuntuTouch/article/details/98871531)

github地址: (https://github.com/elastic/elasticsearch)

官网地址: (https://www.elastic.co/cn/elasticsearch/)

### 使用es的目的
------ 索引、搜索和分析 ------

### es概念
名词: 近实时（NRT）集群(cluster) 节点(node) 索引(index) 文档(document) 分片(shard)
0. es从索引文档写入更新到搜索是有延迟的, 通常为1s, 所以是接近实时

1. es是一个集群(cluster), 集群由一个或者多个节点(node)组成, 下面命令获取整个集群状态
```
GET _cluster/state
```

2. 实际部署环境中, 通常一个服务器或者虚拟机上运行一个节点，位置上相互独立, 节点根据功能可以分为以下几种:

    a. master-eligible: 一般是作为主节点, 负责管理整个集群的设置和变化(索引的创建、更新和删除, 节点的添加删除等等)
   
    b. data node: 存储数据

    c. ingest: 数据接入, 一般是对数据进行预处理, 丰富字段类容, 转换数据格式

    d. machine learning (机器学习)

    e. coordinating node: 协调节点, 通常用来接收客户端的http请求

3. es是面向文档的, 索引和搜索的最小数据单元就是文档, 文档是独立的(数据键值), 是分层的(文档中也可包含文档), 
   结构灵活的(可以不用预设)。
   
   文档被es索引时, 存在在于_source字段之中, 文档在索引中的唯一标志符由_id表示。

4. 索引就是文档的集合, 文档又存在于不同的分片之中, 文档存储是根据id hash计算后存放于对应的分片中。

   一个索引的大小为50G时性能最佳, 当后期一个索引的大小过大时, 可根据日期适当拆分。

5. 一个索引的大小可能会超过节点的限制, 为解决该问题, es会将索引细分为多个数据块(shard), 不提交创建分片时, 默认为一个主分片
   (primary)和一个副分片(replica), 提交创建后主分片数量不可更改, 副分片数量可更改。
   
   主副分片分布在不同的node上, 从而保证一个主分片节点损坏时, 数据依然在于副分片中, 主副分片都可用于数据查询请求, 但其他请求
   比如, 写入数据, 仅仅主分片可以。
   所以, 一般实际使用中, 当需要大量查询数据时, 可以通过增加副分片的数量, 来提高检索速度; 写入数据可以通过最初创建索引时创建
   多个主分片以及更少的副分片来提高写入速度, 但许多小的分片会消耗很多的资源, 所以需要根据索引大小适当分配设置。
   

数据写入时, 协调节点作为路由, 接收到请求, 根据id,索引计算出数据所处的分片, 然后由路由到分片对应的节点写入数据, 之后
找到副本分片, 进行数据复制。(读取数据同理)


###es查询相关
1. 

### es实现搜索词的猜想功能
```json
{
  "mappings": {
    "_doc": {
      "properties": {
        "@timestamp": {
          "type": "date",
          "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
        },
        "department": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "search_term": {
          "type": "completion",
          "analyzer": "standard",
          "preserve_separators": true,
          "preserve_position_increments": true,
          "max_input_length": 50
        }
      }
    }
  }
}
```



